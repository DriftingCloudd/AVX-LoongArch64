## 指令字



# 存储管理系统
存储管理首要的是特权级别的实现，RISC-V采用传统的用户态， 监管态，机器态以及虚拟化模式（可选）实现特权分级，相比之下，Loongarch 架构在虚拟化模式之外采用PLV0-PLV3的特权等级，使用PLV0表示核心态，拥有特权控制命令的权限；一般使用PLV3表示用户态。

PLV1-3都没有使用特权控制命令的权限，3者的区别在于映射翻译模式下的权限不同。Loongarch 架构的MMU采用2种翻译模式，分别是**直接翻译模式** 和 **映射翻译模式**；在直接翻译模式下，如对IOCSR 的控制，物理地址等同于虚拟地址的低$[PALEN-1:0]$位。

翻译模式的选择由CSR中CRMD域选择控制：
- DA=1,PG=0,直接地址翻译模式
- DA=1,PG=1,映射地址翻译模式

## 物理页分配空间
使用$PALEN$表示物理地址最大值，在LA64架构下，$PALEN$ 大小不超过60, 高大于等于4位空间用于执行地址映射。

## 映射地址翻译模式
映射地址翻译模式分为：直接映射地址翻译模式和**页表地址翻译模式**，目前采用的是LA64架构下的直接映射翻译模式。该模式下，Loongarch架构存在4个**映射窗口**：DWM0-DWM3。前2个窗口可用于load/store 操作和 *取指操作*， 后2个窗口用于load/store 操作。

明显，每种窗口匹配的大小是$2^{PALEN}$，高位用于判断命中哪一种映射窗口，从而将在页表映射不合法的虚地址映射到物理地址空间中。

![](assets/Pasted%20image%2020240508170929.png)

## 存储访问类型

