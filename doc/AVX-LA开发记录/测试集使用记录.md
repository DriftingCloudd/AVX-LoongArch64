进行本地评测时，需要下载测试集并进行本地编译，根据`Makefile`生成的sdcard文件，加上没有测试集时编译生成的内核文件（以`_`开头），构造和挂载镜像。
流程：
- `git`下载测试Loongarch64架构仓库
- 本地 `Make`，将生成sdcard文件夹复制到内核中

```md
# 编译测试样例
make all

# 拷贝sdcard
cp -r sdcard StarryOS-LoongArch/testcases/

# 构建镜像
cd StarryOS-LoongArch && ./build_img.sh sdcard

# 启动QEMU，运行内核
make run

```

主要记录在编译测试集中遇到的问题。经过对错误信息的分析，开始的错误主要有2种：
- 在交叉编译链里没有静态库文件存在，如`-ltirpc`、`lssl`
- 本地不存在`musl-gcc`库文件

## `musl-gcc`库

![](picture/Pasted%20image%2020240602190636.png)第二个问题存在，是在内核编译过程使用的`gcc`是`loongarch-linux-gnu-gcc`。从官网下载后，修改`etc/profile`的路径，就成功解决。

## 静态链接库缺失
以下报错表明在**交叉编译器的路径上**存在静态库的缺失（交叉编译使用静态链接库，使用动态库会报错）：

![](picture/Pasted%20image%2020240602190932.png)

解决方式如下：
- 查找交叉编译链使用的库文件（ld）
- 下载对应的库**源码**，配置（configure）Loongarch64架构版本，得到以`.a`为后缀的静态库，放在路径中，重新`make`，检查报错信息

主要问题出在下载源码和重新编译上，在运行`lmbench`时，当配置对应库文件后，出现缺失库链接的错误，错误信息如下：
```c
/../loongarch64-linux-gnu/sysroot/usr/lib/../lib64/libtirpc.a(libtirpc_la-getnetconfig.o): in function `.L113':
getnetconfig.c:(.text+0x744): undefined reference to `pthread_mutex_lock'
```

发现`lmbench`原本的配置文件里没有链接`-lpthread`，在`makefile`的对应位置补充，再编译，没有得到错误（error）输出。

> by wty